{"version":3,"file":"kendo.dataviz.sankey.js","names":["$","window","kendo","dataviz","deepExtend","Box","setDefaultOptions","constants","geometry","drawing","ChartLegend","Legend","sum","array","mapFn","map","reduce","acc","curr","sortAsc","a","b","y0","index","y1","sortSource","source","sortTarget","target","value","node","sortLinks","nodes","forEach","targetLinks","link","sourceLinks","sort","calcLayer","maxDepth","align","depth","height","length","Sankey$1","Class","extend","init","options","ref","nodesOptions","offset","this","data","links","width","offsetX","offsetY","nodeWidth","nodePadding","padding","reverse","targetColumnIndex","loops","autoLayout","calculate","connectLinksToNodes","calculateNodeValues","circularLinks","calculateNodeHeights","columns","calculateNodeDepths","calculateNodeColumns","calculateNodeBreadths","applyNodesOffset","calculateLinkBreadths","nodesMap","Map","i","id","undefined","label","text","set","get","sourceId","targetId","push","Math","max","current","Set","next","currDepth","size","currentNodes","Array","from","n","l","add","nodesLength","currentHeight","eachNode","d","apply","columnWidth","layer","min","x0","x1","this$1$1","kSize","c","y","uncurlLinksToRight","uncurlLinksToLeft","left","top","column","kValue","targetTopPos","dy","arrangeNodesVertically","loop","j","sourceTopPos","endIndex","arrangeUp","arrangeDown","yPos","currentY","i$1","link$1","calculateSankey","rotationDirection","p1x","p1y","p2x","p2y","p3x","p3y","expression1","expression2","SankeyElement","Class$$1","call","createVisual","__proto__","prototype","Object","create","constructor","visual","createElement","exportVisual","customVisual","sender","getSender","visualOptions","getElement","Node","SankeyElement$$1","arguments","rect","Rect","Path","fromRect","fill","color","opacity","stroke","className","role","ariaRoleDescription","ariaLabel","nodeColor","nodeColors","resolveNodeOptions","nodeOptions","defined","util","Link","xC","moveTo","curveTo","INSIDE","BEFORE","Label","totalWidth","position","visible","nodeBox","textbox","TextBox","reflow","textSizeBox","box","goesOutside","textY","center","textOrigin","textRect","translate","renderVisual","font","border","margin","paintOrder","resolveLabelOptions","Title$1","Title$$1","drawingRect","title","Title","buildTitle","CENTER","getSpacing","sortData","item","area","background","areaBackground","areaOpacity","legend","markers","type","cursor","POINTER","BOTTOM","LINK","NODE","Sankey","Observable$$1","element","theme","_initTheme","_setOptions","_initElement","_initSurface","_redraw","_initResizeObserver","destroy","unbind","_destroySurface","_destroyResizeObserver","addClass","setAttribute","tabIndex","getAttribute","description","surface","_initSurfaceElement","_createSurface","observer","ResizeObserver","entries","entry","contentRect","setSize","resize","_resizeObserver","observe","Surface","surfaceElement","mouseenter","_mouseenter","bind","mouseleave","_mouseleave","mousemove","_mousemove","click","_click","currentTheme","setLinksOpacity","linksVisuals","setOpacity","linkOptions","setLinksInactivityOpacity","inactiveOpacity","highlight","linkValue","trigger","name","ev","event","targetType","dataItem","isLink","isNode","isLegendItem","Boolean","chartElement","highlightLinks","nodeVisual","nodesVisuals","originalEvent","relatedTarget","nodeName","tooltipTimeOut","clearTimeout","tooltipShown","tooltip","followPointer","delay","tooltipElType","mouseEvent","getBoundingClientRect","isLeft","clientX","isTop","clientY","tooltipData","popupOffset","pageX","pageY","popupAlign","horizontal","vertical","ref$1","nodeValue","nextDelay","setTimeout","_destroySurfaceElement","disconnect","document","appendChild","parentNode","removeChild","setOptions","clear","_getSize","draw","_render","titleBox","legendBox","calcOptions","sankeyOptions","labels","disableAutoLayout","sankeyBox","legendArea","clone","titleHeight","TOP","unpad","shrink","legendPosition","LEFT","RIGHT","calculatedNodes","console","warn","sankey","nodeEl","nodeOps","nodeInstance","wrap","rectToBox","rawBBox","labelVisual","x2","y2","permutation","columnsLength","results","crosses","link1","link2","f1","f2","f3","f4","linksLength","lNext","nextLink","crossesValue","minCrosses","r","bestResult","find","context","sankeyContext","labelOptions","Group","clip","titleVisual","append","visualNodes","sortedLinks","slice","sourceNode","targetNode","linkOps","colorType","resolveLinkOptions","linkVisual","diagramWidth","textOps","legendVisual","exportOptions","Observable","right","lineJoin","createSankeyData","dimensions","measure","linksMap","row","dimension","key","existingValue","nodesId","nodesArray","String","linksArray","jQuery","Widget","ui","encode","htmlEncode","styleAttr","tooltipContentWrapStyle","TootipText","Square","TooltipTemplates","icon","SankeyTooltip","fn","outerWidth","outerHeight","setContent","content","html","each","el","split","filter","s","parts","style","trim","removeAttribute","setPosition","offsetOption","css","show","hide","remove","Tooltip","ContentTemplates","template","KendoSankey","userOptions","empty","wrapper","_initSankey","_attachEvents","notify","_showWatermarkOverlay","currentOptions","events","eventName","_instance","themeOptions","_getThemeOptions","seriesColors","axisDefaults","seriesDefaults","line","strokeColor","_createSankey","themeName","SASS_THEMES","indexOf","toLowerCase","autoTheme","chart","themes","_events","handler","tooltipShow","tooltipHide","e","_tooltip","doc","ownerDocument","appendTo","body","nodeTemplate","linkTemplate","currentTemplate","format","messages","tooltipUnits","ExportMixin","PDFMixin","plugin","__meta__","category","depends","features","kendo$1"],"sources":["kendo.dataviz.sankey.js"],"mappings":"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","sourcesContent":["import './kendo.core.js';\nimport './kendo.color.js';\nimport './kendo.drawing.js';\nimport './kendo.dataviz.core.js';\nimport './kendo.dataviz.chart.js';\n\n/***********************************************************************\n * WARNING: this file is auto-generated.  If you change it directly,\n * your modifications will eventually be lost.  The source code is in\n * `kendo-charts` repository, you should make your changes there and\n * run `src-modules/sync.sh` in this repository.\n */\n\n(function($) {\n/* eslint-disable */\n\nwindow.kendo.dataviz = window.kendo.dataviz || {};\nvar dataviz = kendo.dataviz;\nvar deepExtend = dataviz.deepExtend;\nvar Box = dataviz.Box;\nvar setDefaultOptions = dataviz.setDefaultOptions;\nvar constants = dataviz.constants;\nvar geometry = kendo.geometry;\nvar drawing = kendo.drawing;\n\nvar ChartLegend = dataviz.Legend;\n\nvar max = function (array, mapFn) { return Math.max.apply(null, array.map(mapFn)); };\nvar min = function (array, mapFn) { return Math.min.apply(null, array.map(mapFn)); };\nvar sum = function (array, mapFn) { return array.map(mapFn).reduce(function (acc, curr) { return (acc + curr); }, 0); };\nvar sortAsc = function (a, b) { return (a.y0 === b.y0 ? a.index - b.index : a.y0 + a.y1 - b.y0 - b.y1); };\nvar sortSource = function (a, b) { return sortAsc(a.source, b.source); };\nvar sortTarget = function (a, b) { return sortAsc(a.target, b.target); };\nvar value = function (node) { return node.value; };\n\nfunction sortLinks(nodes) {\n    nodes.forEach(function (node) {\n        node.targetLinks.forEach(function (link) {\n            link.source.sourceLinks.sort(sortTarget);\n        });\n        node.sourceLinks.forEach(function (link) {\n            link.target.targetLinks.sort(sortSource);\n        });\n    });\n}\n\nvar calcLayer = function (node, maxDepth) {\n    if (node.align === 'left') {\n        return node.depth;\n    }\n\n    if (node.align === 'right') {\n        return maxDepth - node.height;\n    }\n\n    return node.sourceLinks.length ? node.depth : maxDepth;\n};\n\nvar Sankey$1 = kendo.Class.extend({\n    init: function(options) {\n        var ref = options.nodesOptions;\n        var offset = ref.offset; if (offset === void 0) { offset = {}; }\n        var align = ref.align;\n        this.data = {\n            nodes: options.nodes.map(function (node) { return deepExtend({}, { offset: offset, align: align }, node); }),\n            links: options.links.map(function (link) { return deepExtend({}, link); })\n        };\n\n        this.width = options.width;\n        this.height = options.height;\n        this.offsetX = options.offsetX || 0;\n        this.offsetY = options.offsetY || 0;\n        this.nodeWidth = options.nodesOptions.width;\n        this.nodePadding = options.nodesOptions.padding;\n        this.reverse = options.reverse;\n        this.targetColumnIndex = options.targetColumnIndex;\n        this.loops = options.loops;\n        this.autoLayout = options.autoLayout;\n    },\n\n    calculate: function() {\n        var ref = this.data;\n        var nodes = ref.nodes;\n        var links = ref.links;\n        this.connectLinksToNodes(nodes, links);\n        this.calculateNodeValues(nodes);\n\n        var circularLinks = this.calculateNodeHeights(nodes);\n\n        if (circularLinks) {\n            return { nodes: [], links: [], columns: [], circularLinks: circularLinks };\n        }\n\n        this.calculateNodeDepths(nodes);\n        var columns = this.calculateNodeColumns(nodes);\n        this.calculateNodeBreadths(columns);\n        this.applyNodesOffset(nodes);\n        this.calculateLinkBreadths(nodes);\n\n        return $.extend({}, this.data, {columns: columns});\n    },\n\n    connectLinksToNodes: function(nodes, links) {\n        var nodesMap = new Map();\n\n        nodes.forEach(function (node, i) {\n            node.index = i;\n            node.sourceLinks = [];\n            node.targetLinks = [];\n            node.id = node.id !== undefined ? node.id : node.label.text;\n            nodesMap.set(node.id, node);\n        });\n\n        links.forEach(function (link) {\n            link.source = nodesMap.get(link.sourceId);\n            link.target = nodesMap.get(link.targetId);\n            link.source.sourceLinks.push(link);\n            link.target.targetLinks.push(link);\n        });\n    },\n\n    calculateNodeValues: function(nodes) {\n        nodes.forEach(function (node) {\n            node.value = Math.max(\n                sum(node.sourceLinks, value),\n                sum(node.targetLinks, value)\n            );\n        });\n    },\n\n    calculateNodeDepths: function(nodes) {\n        var current = new Set(nodes);\n        var next = new Set();\n        var currDepth = 0;\n        while (current.size) {\n            var currentNodes = Array.from(current);\n            for (var n = 0; n < currentNodes.length; n++) {\n                var node = currentNodes[n];\n                node.depth = currDepth;\n                for (var l = 0; l < node.sourceLinks.length; l++) {\n                    var link = node.sourceLinks[l];\n                    next.add(link.target);\n                }\n            }\n            currDepth++;\n            current = next;\n            next = new Set();\n        }\n    },\n\n    calculateNodeHeights: function(nodes) {\n        var nodesLength = nodes.length;\n        var current = new Set(nodes);\n        var next = new Set;\n        var currentHeight = 0;\n        var eachNode = function (node) {\n            node.height = currentHeight;\n            node.targetLinks.forEach(function (link) {\n                next.add(link.source);\n            });\n        };\n        while (current.size) {\n            current.forEach(eachNode);\n            currentHeight++;\n            if (currentHeight > nodesLength) {\n                return true;\n            }\n            current = next;\n            next = new Set;\n        }\n        return false;\n    },\n\n    calculateNodeColumns: function(nodes) {\n        var this$1$1 = this;\n\n        var maxDepth = max(nodes, function (d) { return d.depth; });\n        var columnWidth = (this.width - this.offsetX - this.nodeWidth) / maxDepth;\n        var columns = new Array(maxDepth + 1);\n        for (var i = 0; i < nodes.length; i++) {\n            var node = nodes[i];\n            var layer = Math.max(0, Math.min(maxDepth, calcLayer(node, maxDepth)));\n            node.x0 = this$1$1.offsetX + layer * columnWidth;\n            node.x1 = node.x0 + this$1$1.nodeWidth;\n            node.layer = layer;\n            columns[layer] = columns[layer] || [];\n            columns[layer].push(node);\n        }\n\n        return columns;\n    },\n\n    calculateNodeBreadths: function(columns) {\n        var this$1$1 = this;\n\n        var kSize = min(columns, function (c) { return (this$1$1.height - this$1$1.offsetY - (c.length - 1) * this$1$1.nodePadding) / sum(c, value); });\n\n        columns.forEach(function (nodes) {\n            var y = this$1$1.offsetY;\n            nodes.forEach(function (node) {\n                node.y0 = y;\n                node.y1 = y + node.value * kSize;\n                y = node.y1 + this$1$1.nodePadding;\n                node.sourceLinks.forEach(function (link) {\n                    link.width = link.value * kSize;\n                });\n            });\n            y = (this$1$1.height - y + this$1$1.nodePadding) / (nodes.length + 1);\n            nodes.forEach(function (node, i) {\n                node.y0 += y * (i + 1);\n                node.y1 += y * (i + 1);\n            });\n        });\n\n        if (this.autoLayout !== false) {\n            var loops = this.loops !== undefined ? this.loops : columns.length - 1;\n            var targetColumnIndex = this.targetColumnIndex || 1;\n\n            for (var i = 0; i < loops; i++) {\n                if (!this$1$1.reverse) {\n                    this$1$1.uncurlLinksToLeft(columns, targetColumnIndex);\n                    this$1$1.uncurlLinksToRight(columns, targetColumnIndex);\n                } else {\n                    this$1$1.uncurlLinksToRight(columns, targetColumnIndex);\n                    this$1$1.uncurlLinksToLeft(columns, targetColumnIndex);\n                }\n            }\n        }\n\n        columns.forEach(sortLinks);\n    },\n\n    applyNodesOffset: function(nodes) {\n        nodes.forEach(function (node) {\n            var offsetX = (node.offset ? node.offset.left : 0) || 0;\n            var offsetY = (node.offset ? node.offset.top : 0) || 0;\n            node.x0 += offsetX;\n            node.x1 += offsetX;\n            node.y0 += offsetY;\n            node.y1 += offsetY;\n        });\n    },\n\n    calculateLinkBreadths: function(nodes) {\n        nodes.forEach(function (node) {\n            var sourceLinks = node.sourceLinks;\n            var targetLinks = node.targetLinks;\n            var y = node.y0;\n            var y1 = y;\n            sourceLinks.forEach(function (link) {\n                link.x0 = link.source.x1;\n                link.y0 = y + link.width / 2;\n                y += link.width;\n            });\n            targetLinks.forEach(function (link) {\n                link.x1 = link.target.x0;\n                link.y1 = y1 + link.width / 2;\n                y1 += link.width;\n            });\n        });\n    },\n\n    uncurlLinksToRight: function(columns, targetColumnIndex) {\n        var this$1$1 = this;\n\n        var n = columns.length;\n        for (var i = targetColumnIndex; i < n; i++) {\n            var column = columns[i];\n            column.forEach(function (target) {\n                var y = 0;\n                var sum = 0;\n                target.targetLinks.forEach(function (link) {\n                    var kValue = link.value * (target.layer - link.source.layer);\n                    y += this$1$1.targetTopPos(link.source, target) * kValue;\n                    sum += kValue;\n                });\n\n                var dy = y === 0 ? 0 : (y / sum - target.y0);\n                target.y0 += dy;\n                target.y1 += dy;\n                sortLinks([target]);\n            });\n            column.sort(sortAsc);\n            this$1$1.arrangeNodesVertically(column);\n        }\n    },\n\n    uncurlLinksToLeft: function(columns, targetColumnIndex) {\n        var this$1$1 = this;\n\n        var l = columns.length;\n        var startIndex = l - 1 - targetColumnIndex;\n        for (var i = startIndex; i >= 0; i--) {\n            var column = columns[i];\n            var loop = function ( j ) {\n                var source = column[j];\n                var y = 0;\n                var sum = 0;\n                source.sourceLinks.forEach(function (link) {\n                    var kValue = link.value * (link.target.layer - source.layer);\n                    y += this$1$1.sourceTopPos(source, link.target) * kValue;\n                    sum += kValue;\n                });\n                var dy = y === 0 ? 0 : (y / sum - source.y0);\n                source.y0 += dy;\n                source.y1 += dy;\n                sortLinks([source]);\n            };\n\n            for (var j = 0; j < column.length; j++) loop( j );\n\n            column.sort(sortAsc);\n            this$1$1.arrangeNodesVertically(column);\n        }\n    },\n\n    arrangeNodesVertically: function(nodes) {\n        var startIndex = 0;\n        var endIndex = nodes.length - 1;\n\n        this.arrangeUp(nodes, this.height, endIndex);\n        this.arrangeDown(nodes, this.offsetY, startIndex);\n    },\n\n    arrangeDown: function(nodes, yPos, index) {\n        var this$1$1 = this;\n\n        var currentY = yPos;\n\n        for (var i = index; i < nodes.length; i++) {\n            var node = nodes[i];\n            var dy = Math.max(0, currentY - node.y0);\n            node.y0 += dy;\n            node.y1 += dy;\n            currentY = node.y1 + this$1$1.nodePadding;\n        }\n    },\n\n    arrangeUp: function(nodes, yPos, index) {\n        var this$1$1 = this;\n\n        var currentY = yPos;\n        for (var i = index; i >= 0; --i) {\n            var node = nodes[i];\n            var dy = Math.max(0, node.y1 - currentY);\n            node.y0 -= dy;\n            node.y1 -= dy;\n            currentY = node.y0 - this$1$1.nodePadding;\n        }\n    },\n\n    sourceTopPos: function(source, target) {\n        var this$1$1 = this;\n\n        var y = target.y0 - ((target.targetLinks.length - 1) * this.nodePadding) / 2;\n        for (var i = 0; i < target.targetLinks.length; i++) {\n            var link = target.targetLinks[i];\n            if (link.source === source) {\n                break;\n            }\n            y += link.width + this$1$1.nodePadding;\n        }\n        for (var i$1 = 0; i$1 < source.sourceLinks.length; i$1++) {\n            var link$1 = source.sourceLinks[i$1];\n            if (link$1.target === target) {\n                break;\n            }\n            y -= link$1.width;\n        }\n        return y;\n    },\n\n    targetTopPos: function(source, target) {\n        var this$1$1 = this;\n\n        var y = source.y0 - ((source.sourceLinks.length - 1) * this.nodePadding) / 2;\n        for (var i = 0; i < source.sourceLinks.length; i++) {\n            var link = source.sourceLinks[i];\n            if (link.target === target) {\n                break;\n            }\n            y += link.width + this$1$1.nodePadding;\n        }\n        for (var i$1 = 0; i$1 < target.targetLinks.length; i$1++) {\n            var link$1 = target.targetLinks[i$1];\n            if (link$1.source === source) {\n                break;\n            }\n            y -= link$1.width;\n        }\n        return y;\n    }\n});\n\nvar calculateSankey = function (options) { return new Sankey$1(options).calculate(); };\n\nvar crossesValue = function (links) {\n    var value = 0;\n    var linksLength = links.length;\n\n    for (var i = 0; i < linksLength; i++) {\n        var link = links[i];\n\n        for (var lNext = i + 1; lNext < linksLength; lNext++) {\n            var nextLink = links[lNext];\n\n            if (intersect(link, nextLink)) {\n                value += Math.min(link.value, nextLink.value);\n            }\n        }\n    }\n\n    return value;\n};\n\nfunction rotationDirection(p1x, p1y, p2x, p2y, p3x, p3y) {\n    var expression1 = (p3y - p1y) * (p2x - p1x);\n    var expression2 = (p2y - p1y) * (p3x - p1x);\n\n    if (expression1 > expression2) {\n        return 1;\n    } else if (expression1 === expression2) {\n        return 0;\n    }\n\n    return -1;\n}\n\nfunction intersect(link1, link2) {\n    var f1 = rotationDirection(link1.x0, link1.y0, link1.x1, link1.y1, link2.x1, link2.y1);\n    var f2 = rotationDirection(link1.x0, link1.y0, link1.x1, link1.y1, link2.x0, link2.y0);\n    var f3 = rotationDirection(link1.x0, link1.y0, link2.x0, link2.y0, link2.x1, link2.y1);\n    var f4 = rotationDirection(link1.x1, link1.y1, link2.x0, link2.y0, link2.x1, link2.y1);\n\n    return f1 !== f2 && f3 !== f4;\n}\n\nvar SankeyElement = (function (Class$$1) {\n    function SankeyElement(options) {\n        Class$$1.call(this);\n        this.options = deepExtend({}, this.options, options);\n        this.createVisual();\n    }\n\n    if ( Class$$1 ) SankeyElement.__proto__ = Class$$1;\n    SankeyElement.prototype = Object.create( Class$$1 && Class$$1.prototype );\n    SankeyElement.prototype.constructor = SankeyElement;\n\n    SankeyElement.prototype.createVisual = function createVisual () {\n        this.visual = this.createElement();\n    };\n\n    SankeyElement.prototype.exportVisual = function exportVisual () {\n        return this.visual;\n    };\n\n    SankeyElement.prototype.createElement = function createElement () {\n        var this$1$1 = this;\n\n        var customVisual = this.options.visual;\n        var visual;\n\n        if (customVisual) {\n            visual = customVisual({\n                sender: this.getSender(),\n                options: this.visualOptions(),\n                createVisual: function () { return this$1$1.getElement(); }\n            });\n        } else {\n            visual = this.getElement();\n        }\n\n        return visual;\n    };\n\n    SankeyElement.prototype.getSender = function getSender () {\n        return this;\n    };\n\n    return SankeyElement;\n}(dataviz.Class));\n\nvar Node = (function (SankeyElement$$1) {\n    function Node () {\n        SankeyElement$$1.apply(this, arguments);\n    }\n\n    if ( SankeyElement$$1 ) Node.__proto__ = SankeyElement$$1;\n    Node.prototype = Object.create( SankeyElement$$1 && SankeyElement$$1.prototype );\n    Node.prototype.constructor = Node;\n\n    Node.prototype.getElement = function getElement () {\n        var options = this.options;\n        var node = options.node;\n        var rect = new geometry.Rect([node.x0, node.y0], [node.x1 - node.x0, node.y1 - node.y0]);\n\n        return drawing.Path.fromRect(rect, this.visualOptions());\n    };\n\n    Node.prototype.visualOptions = function visualOptions () {\n        var options = deepExtend({}, this.options, this.options.node);\n\n        return {\n            fill: {\n                color: options.color,\n                opacity: options.opacity\n            },\n            stroke: { width: 0 },\n            className: 'k-sankey-node',\n            role: 'graphics-symbol',\n            ariaRoleDescription: 'Node',\n            ariaLabel: options.node.label.text\n        };\n    };\n\n    return Node;\n}(SankeyElement));\n\nvar nodeColor = function (node, nodeColors, index) { return node.color || nodeColors[index % nodeColors.length]; };\n\nvar resolveNodeOptions = function (node, options, nodeColors, index) {\n    var nodeOptions = deepExtend({}, options, options.node);\n    return deepExtend({},\n        { color: nodeColor(node, nodeColors, index) },\n        nodeOptions,\n        { node: node },\n        {\n            visual: node.visual,\n            opacity: node.opacity,\n            offset: node.offset,\n            color: node.color\n        }\n    );\n};\n\nvar ref = drawing.util;\nvar defined = ref.defined;\n\nvar Link = (function (SankeyElement$$1) {\n    function Link () {\n        SankeyElement$$1.apply(this, arguments);\n    }\n\n    if ( SankeyElement$$1 ) Link.__proto__ = SankeyElement$$1;\n    Link.prototype = Object.create( SankeyElement$$1 && SankeyElement$$1.prototype );\n    Link.prototype.constructor = Link;\n\n    Link.prototype.getElement = function getElement () {\n        var link = this.options.link;\n        var x0 = link.x0;\n        var x1 = link.x1;\n        var y0 = link.y0;\n        var y1 = link.y1;\n        var xC = (x0 + x1) / 2;\n\n        return new drawing.Path(this.visualOptions())\n            .moveTo(x0, y0).curveTo([xC, y0], [xC, y1], [x1, y1]);\n    };\n\n    Link.prototype.visualOptions = function visualOptions () {\n        var options = this.options;\n        var link = this.options.link;\n        return {\n            stroke: {\n                width: options.link.width,\n                color: link.color || options.color,\n                opacity: defined(link.opacity) ? link.opacity : options.opacity\n            }\n        };\n    };\n\n    return Link;\n}(SankeyElement));\n\nvar resolveLinkOptions = function (link, options, sourceNode, targetNode) {\n    var linkOptions = deepExtend({},\n        options,\n        {\n            link: link,\n            opacity: link.opacity,\n            color: link.color,\n            colorType: link.colorType,\n            visual: link.visual,\n            highlight: link.highlight\n        }\n    );\n\n    if (linkOptions.colorType === 'source') {\n        linkOptions.color = sourceNode.options.fill.color;\n    } else if (linkOptions.colorType === 'target') {\n        linkOptions.color = targetNode.options.fill.color;\n    }\n\n    return linkOptions;\n};\n\nvar INSIDE = 'inside';\nvar BEFORE = 'before';\nvar AFTER = 'after';\n\nvar Label = (function (SankeyElement$$1) {\n    function Label () {\n        SankeyElement$$1.apply(this, arguments);\n    }\n\n    if ( SankeyElement$$1 ) Label.__proto__ = SankeyElement$$1;\n    Label.prototype = Object.create( SankeyElement$$1 && SankeyElement$$1.prototype );\n    Label.prototype.constructor = Label;\n\n    Label.prototype.getElement = function getElement () {\n        var options = deepExtend({}, this.options, this.options.node.label);\n        var node = options.node;\n        var totalWidth = options.totalWidth;\n        var position = options.position;\n        var text = options.text;\n        var offset = options.offset;\n\n        if (!options.visible || !text) {\n            return null;\n        }\n\n        var nodeBox = new Box(node.x0, node.y0, node.x1, node.y1);\n        var visualOptions = this.visualOptions();\n        var textbox = new dataviz.TextBox(text, visualOptions);\n        textbox.reflow(new Box());\n        var textSizeBox = textbox.box;\n\n        var goesOutside = node.x1 + textSizeBox.width() > totalWidth;\n        var textY = nodeBox.center().y - (textSizeBox.height() / 2);\n        var side = position === BEFORE || (position === INSIDE && goesOutside) ? BEFORE : AFTER;\n        var textOrigin = [side === BEFORE ? node.x0 - textSizeBox.width() : node.x1, textY];\n\n        var textRect = new Box(textOrigin[0], textOrigin[1], textOrigin[0] + textSizeBox.width(), textOrigin[1] + textSizeBox.height());\n        textRect.translate(offset.left || 0, offset.top || 0);\n        textbox.reflow(textRect);\n\n        textbox.renderVisual();\n\n        return textbox.visual;\n    };\n\n    Label.prototype.visualOptions = function visualOptions () {\n        var options = deepExtend({}, this.options, this.options.node.label);\n        return {\n            color: options.color,\n            font: options.font,\n            border: options.border,\n            margin: options.margin,\n            padding: options.padding,\n            align: options.align,\n            paintOrder: options.paintOrder,\n            stroke: options.stroke,\n        };\n    };\n\n    return Label;\n}(SankeyElement));\n\nsetDefaultOptions(Label, {\n    position: INSIDE, // inside, before, after\n});\n\nvar resolveLabelOptions = function (node, options, totalWidth) { return deepExtend({},\n    options,\n    {\n        node: node,\n        totalWidth: totalWidth,\n        visual: node.label.visual,\n        visible: node.label.visible,\n        margin: node.label.margin,\n        padding: node.label.padding,\n        border: node.label.border,\n        align: node.label.align,\n        offset: node.label.offset\n    }\n); };\n\nvar Title$1 = (function (SankeyElement$$1) {\n    function Title$$1 () {\n        SankeyElement$$1.apply(this, arguments);\n    }\n\n    if ( SankeyElement$$1 ) Title$$1.__proto__ = SankeyElement$$1;\n    Title$$1.prototype = Object.create( SankeyElement$$1 && SankeyElement$$1.prototype );\n    Title$$1.prototype.constructor = Title$$1;\n\n    Title$$1.prototype.getElement = function getElement () {\n        var options = this.options;\n        var drawingRect = options.drawingRect;\n        var text = options.text;\n\n        if (options.visible === false || !text) {\n            return null;\n        }\n\n        var title = dataviz.Title.buildTitle(text, options);\n\n        title.reflow(drawingRect);\n\n        title.renderVisual();\n        return title.visual;\n    };\n\n    Title$$1.prototype.createElement = function createElement () {\n        return this.getElement();\n    };\n\n    return Title$$1;\n}(SankeyElement));\n\nsetDefaultOptions(Title$1, {\n    align: constants.CENTER, // 'left', 'right', 'center'\n    border: {\n        width: 0\n    },\n    margin: dataviz.getSpacing(5),\n    padding: dataviz.getSpacing(5)\n});\n\nvar AREA = \"area\";\n\nvar sortData = function (a, b) {\n    if (a.node.x0 - b.node.x0 !== 0) {\n        return a.node.x0 - b.node.x0;\n    }\n    return a.node.y0 - b.node.y0;\n};\n\nvar Legend = (function (SankeyElement$$1) {\n    function Legend () {\n        SankeyElement$$1.apply(this, arguments);\n    }\n\n    if ( SankeyElement$$1 ) Legend.__proto__ = SankeyElement$$1;\n    Legend.prototype = Object.create( SankeyElement$$1 && SankeyElement$$1.prototype );\n    Legend.prototype.constructor = Legend;\n\n    Legend.prototype.getElement = function getElement () {\n        var options = this.options;\n        var drawingRect = options.drawingRect;\n        var nodes = options.nodes; if (nodes === void 0) { nodes = []; }\n        var item = options.item;\n\n        if (options.visible === false || !nodes.length) {\n            return null;\n        }\n\n        var data = nodes.map(function (node) { return ({\n            text: (node.label && node.label.text) || '',\n            area: {\n                background: item.areaBackground !== undefined ? item.areaBackground : node.color,\n                opacity: item.areaOpacity !== undefined ? item.areaOpacity : node.opacity\n            },\n            node: node,\n        }); });\n\n        data.sort(sortData);\n\n        var legend = new ChartLegend($.extend({}, options, {data: data}));\n        legend.reflow(drawingRect);\n\n        legend.renderVisual();\n        return legend.visual;\n    };\n\n    Legend.prototype.createElement = function createElement () {\n        return this.getElement();\n    };\n\n    return Legend;\n}(SankeyElement));\n\nsetDefaultOptions(Legend, {\n    markers: { visible: false },\n    item: {\n        type: AREA,\n        cursor: constants.POINTER,\n        opacity: 1\n    },\n    position: constants.BOTTOM,\n    align: constants.CENTER,\n    border: {\n        width: 0\n    }\n});\n\nvar LINK = 'link';\nvar NODE = 'node';\n\nvar Sankey = (function (Observable$$1) {\n    function Sankey(element, options, theme) {\n        Observable$$1.call(this);\n\n        this._initTheme(theme);\n        this._setOptions(options);\n        this._initElement(element);\n        this._initSurface();\n\n        if (options && options.data) {\n            this._redraw();\n            this._initResizeObserver();\n        }\n    }\n\n    if ( Observable$$1 ) Sankey.__proto__ = Observable$$1;\n    Sankey.prototype = Object.create( Observable$$1 && Observable$$1.prototype );\n    Sankey.prototype.constructor = Sankey;\n\n    Sankey.prototype.destroy = function destroy () {\n        this.unbind();\n        this._destroySurface();\n        this._destroyResizeObserver();\n    };\n\n    Sankey.prototype._initElement = function _initElement (element) {\n        this.element = element;\n        dataviz.addClass(element, [ \"k-chart\", \"k-sankey\" ]);\n        element.setAttribute('role', 'graphics-document');\n        element.tabIndex = element.getAttribute(\"tabindex\") || 0;\n\n        var ref = this.options;\n        var title = ref.title;\n\n        if (title.text) {\n            element.setAttribute('aria-label', title.text);\n        }\n\n        if (title.description) {\n            element.setAttribute(\"aria-roledescription\", title.description);\n        }\n    };\n\n    Sankey.prototype._initSurface = function _initSurface () {\n        if (!this.surface) {\n            this._destroySurface();\n            this._initSurfaceElement();\n            this.surface = this._createSurface();\n        }\n    };\n\n    Sankey.prototype._initResizeObserver = function _initResizeObserver () {\n        var this$1$1 = this;\n\n        var observer = new ResizeObserver(function (entries) {\n            entries.forEach(function (entry) {\n                var ref = entry.contentRect;\n                var width = ref.width;\n                var height = ref.height;\n                if (entry.target !== this$1$1.element ||\n                    (this$1$1.size && this$1$1.size.width === width && this$1$1.size.height === height)) {\n                    return;\n                }\n                this$1$1.size = { width: width, height: height };\n                this$1$1.surface.setSize(this$1$1.size);\n                this$1$1.resize = true;\n                this$1$1._redraw();\n            });\n        });\n        this._resizeObserver = observer;\n        observer.observe(this.element);\n    };\n\n    Sankey.prototype._createSurface = function _createSurface () {\n        return drawing.Surface.create(this.surfaceElement, {\n            mouseenter: this._mouseenter.bind(this),\n            mouseleave: this._mouseleave.bind(this),\n            mousemove: this._mousemove.bind(this),\n            click: this._click.bind(this)\n        });\n    };\n\n    Sankey.prototype._initTheme = function _initTheme (theme) {\n        var currentTheme = theme || this.theme || {};\n        this.theme = currentTheme;\n        this.options = deepExtend({}, currentTheme, this.options);\n    };\n\n    Sankey.prototype.setLinksOpacity = function setLinksOpacity (opacity) {\n        var this$1$1 = this;\n\n        this.linksVisuals.forEach(function (link) {\n            this$1$1.setOpacity(link, opacity, link.linkOptions.opacity);\n        });\n    };\n\n    Sankey.prototype.setLinksInactivityOpacity = function setLinksInactivityOpacity (inactiveOpacity) {\n        var this$1$1 = this;\n\n        this.linksVisuals.forEach(function (link) {\n            this$1$1.setOpacity(link, inactiveOpacity, link.linkOptions.highlight.inactiveOpacity);\n        });\n    };\n\n    Sankey.prototype.setOpacity = function setOpacity (link, opacity, linkValue) {\n        link.options.set('stroke', $.extend({}, link.options.stroke,\n            {opacity: defined(linkValue) ? linkValue : opacity}));\n    };\n\n    Sankey.prototype.trigger = function trigger (name, ev) {\n        var event = $.extend({}, ev,\n            {type: name,\n            targetType: ev.element.type,\n            dataItem: ev.element.dataItem});\n\n        return Observable$$1.prototype.trigger.call(this, name, event);\n    };\n\n    Sankey.prototype._mouseenter = function _mouseenter (ev) {\n        var element = ev.element;\n        var isLink = element.type === LINK;\n        var isNode = element.type === NODE;\n        var isLegendItem = Boolean(element.chartElement && element.chartElement.options.node);\n\n        if ((isLink && this.trigger('linkEnter', ev)) ||\n            (isNode && this.trigger('nodeEnter', ev))) {\n            return;\n        }\n\n        var ref = this.options.links;\n        var highlight = ref.highlight;\n        if (isLink) {\n            this.setLinksInactivityOpacity(highlight.inactiveOpacity);\n            this.setOpacity(element, highlight.opacity, element.linkOptions.highlight.opacity);\n        } else if (isNode) {\n            this.highlightLinks(element, highlight);\n        } else if (isLegendItem) {\n            var nodeVisual = this.nodesVisuals.get(element.chartElement.options.node.id);\n            this.highlightLinks(nodeVisual, highlight);\n        }\n    };\n\n    Sankey.prototype._mouseleave = function _mouseleave (ev) {\n        var this$1$1 = this;\n\n        var element = ev.element;\n        var isLink = element.type === LINK;\n        var isNode = element.type === NODE;\n        var isLegendItem = Boolean(element.chartElement && element.chartElement.options.node);\n        var target = ev.originalEvent.relatedTarget;\n\n        if (isLink && target && target.nodeName === 'text') {\n            return;\n        }\n\n        if (isLink || isNode) {\n            if (this.tooltipTimeOut) {\n                clearTimeout(this.tooltipTimeOut);\n                this.tooltipTimeOut = null;\n            }\n            this.tooltipShown = false;\n            this.trigger('tooltipHide', ev);\n        }\n\n        if ((isLink && this.trigger('linkLeave', ev)) ||\n            (isNode && this.trigger('nodeLeave', ev))) {\n            return;\n        }\n\n        if (isLink || isNode || isLegendItem) {\n            this.linksVisuals.forEach(function (link) {\n                this$1$1.setOpacity(link, this$1$1.options.links.opacity, link.linkOptions.opacity);\n            });\n        }\n    };\n\n    Sankey.prototype._mousemove = function _mousemove (ev) {\n        var this$1$1 = this;\n\n        var ref = this.options.tooltip;\n        var followPointer = ref.followPointer;\n        var delay = ref.delay;\n        var element = ev.element;\n        var tooltipElType = element.type;\n\n        if ((tooltipElType !== LINK && tooltipElType !== NODE) || (this.tooltipShown && !followPointer)) {\n            return;\n        }\n\n        var mouseEvent = ev.originalEvent;\n        var rect = this.element.getBoundingClientRect();\n        var isLeft = mouseEvent.clientX - rect.left < rect.width / 2;\n        var isTop = mouseEvent.clientY - rect.top < rect.height / 2;\n\n        ev.tooltipData = {\n            popupOffset: {\n                left: mouseEvent.pageX,\n                top: mouseEvent.pageY\n            },\n            popupAlign: {\n                horizontal: isLeft ? 'left' : 'right',\n                vertical: isTop ? 'top' : 'bottom'\n            }\n        };\n\n        if (tooltipElType === NODE) {\n            var ref$1 = element.dataItem;\n            var sourceLinks = ref$1.sourceLinks;\n            var targetLinks = ref$1.targetLinks;\n            var links = targetLinks.length ? targetLinks : sourceLinks;\n            ev.nodeValue = links.reduce(function (acc, link) { return acc + link.value; }, 0);\n        }\n\n        if (this.tooltipTimeOut) {\n            clearTimeout(this.tooltipTimeOut);\n            this.tooltipTimeOut = null;\n        }\n\n        var nextDelay = followPointer && this.tooltipShown ? 0 : delay;\n\n        this.tooltipTimeOut = setTimeout(function () {\n            this$1$1.trigger('tooltipShow', ev);\n            this$1$1.tooltipShown = true;\n            this$1$1.tooltipTimeOut = null;\n        }, nextDelay);\n    };\n\n    Sankey.prototype._click = function _click (ev) {\n        var element = ev.element;\n        var isLink = element.type === LINK;\n        var isNode = element.type === NODE;\n\n        if (isNode) {\n            this.trigger('nodeClick', ev);\n        } else if (isLink) {\n            this.trigger('linkClick', ev);\n        }\n    };\n\n    Sankey.prototype.highlightLinks = function highlightLinks (node, highlight) {\n        var this$1$1 = this;\n\n        if (node) {\n            this.setLinksInactivityOpacity(highlight.inactiveOpacity);\n            node.links.forEach(function (link) {\n                this$1$1.setOpacity(link, highlight.opacity, link.linkOptions.highlight.opacity);\n            });\n        }\n    };\n\n    Sankey.prototype._destroySurface = function _destroySurface () {\n        if (this.surface) {\n            this.surface.destroy();\n            this.surface = null;\n            this._destroySurfaceElement();\n        }\n    };\n\n    Sankey.prototype._destroyResizeObserver = function _destroyResizeObserver () {\n        if (this._resizeObserver) {\n            this._resizeObserver.disconnect();\n            this._resizeObserver = null;\n        }\n    };\n\n    Sankey.prototype._initSurfaceElement = function _initSurfaceElement () {\n        if (!this.surfaceElement) {\n            this.surfaceElement = document.createElement('div');\n            this.element.appendChild(this.surfaceElement);\n        }\n    };\n\n    Sankey.prototype._destroySurfaceElement = function _destroySurfaceElement () {\n        if (this.surfaceElement && this.surfaceElement.parentNode) {\n            this.surfaceElement.parentNode.removeChild(this.surfaceElement);\n            this.surfaceElement = null;\n        }\n    };\n\n    Sankey.prototype.setOptions = function setOptions (options, theme) {\n        this._setOptions(options);\n        this._initTheme(theme);\n        this._initSurface();\n        this._redraw();\n    };\n\n    Sankey.prototype._redraw = function _redraw () {\n        this.surface.clear();\n\n        var ref = this._getSize();\n        var width = ref.width;\n        var height = ref.height;\n        this.size = { width: width, height: height };\n        this.surface.setSize(this.size);\n\n        this.createVisual();\n\n        this.surface.draw(this.visual);\n    };\n\n    Sankey.prototype._getSize = function _getSize () {\n        return this.element.getBoundingClientRect();\n    };\n\n    Sankey.prototype.createVisual = function createVisual () {\n        this.visual = this._render();\n    };\n\n    Sankey.prototype.titleBox = function titleBox (title, drawingRect) {\n        if (!title || title.visible === false || !title.text) {\n            return null;\n        }\n\n        var titleElement = new Title$1($.extend({}, {drawingRect: drawingRect}, title));\n        var titleVisual = titleElement.exportVisual();\n        return titleVisual.chartElement.box;\n    };\n\n    Sankey.prototype.legendBox = function legendBox (options, nodes, drawingRect) {\n        if (!options || options.visible === false) {\n            return null;\n        }\n\n        var legend = new Legend($.extend({}, {nodes: nodes}, options, {drawingRect: drawingRect}));\n        var legendVisual = legend.exportVisual();\n\n        return legendVisual.chartElement.box;\n    };\n\n    Sankey.prototype.calculateSankey = function calculateSankey$1 (calcOptions, sankeyOptions) {\n        var title = sankeyOptions.title;\n        var legend = sankeyOptions.legend;\n        var data = sankeyOptions.data;\n        var nodes = sankeyOptions.nodes;\n        var labels = sankeyOptions.labels;\n        var nodeColors = sankeyOptions.nodeColors;\n        var disableAutoLayout = sankeyOptions.disableAutoLayout;\n        var autoLayout = !disableAutoLayout;\n\n        var sankeyBox = new Box(0, 0, calcOptions.width, calcOptions.height);\n        var titleBox = this.titleBox(title, sankeyBox);\n\n        var legendArea = sankeyBox.clone();\n\n        if (titleBox) {\n            var titleHeight = titleBox.height();\n            if (title.position === constants.TOP) {\n                sankeyBox.unpad({ top: titleHeight });\n                legendArea = new Box(0, titleHeight, calcOptions.width, calcOptions.height);\n            } else {\n                sankeyBox.shrink(0, titleHeight);\n                legendArea = new Box(0, 0, calcOptions.width, calcOptions.height - titleHeight);\n            }\n        }\n\n        var legendBox = this.legendBox(legend, data.nodes, legendArea);\n        var legendPosition = (legend && legend.position) || Legend.prototype.options.position;\n\n        if (legendBox) {\n            if (legendPosition === constants.LEFT) {\n                sankeyBox.unpad({ left: legendBox.width() });\n            }\n\n            if (legendPosition === constants.RIGHT) {\n                sankeyBox.shrink(legendBox.width(), 0);\n            }\n\n            if (legendPosition === constants.TOP) {\n                sankeyBox.unpad({ top: legendBox.height() });\n            }\n\n            if (legendPosition === constants.BOTTOM) {\n                sankeyBox.shrink(0, legendBox.height());\n            }\n        }\n\n        var ref = calculateSankey($.extend({}, calcOptions, {offsetX: 0, offsetY: 0, width: sankeyBox.width(), height: sankeyBox.height()}));\n        var calculatedNodes = ref.nodes;\n        var circularLinks = ref.circularLinks;\n        if (circularLinks) {\n            console.warn('Circular links detected. Kendo Sankey diagram does not support circular links.');\n            return { sankey: { nodes: [], links: [], circularLinks: circularLinks }, legendBox: legendBox, titleBox: titleBox };\n        }\n\n        var box = new Box();\n\n        calculatedNodes.forEach(function (nodeEl, i) {\n            var nodeOps = resolveNodeOptions(nodeEl, nodes, nodeColors, i);\n            var nodeInstance = new Node(nodeOps);\n            box.wrap(dataviz.rectToBox(nodeInstance.exportVisual().rawBBox()));\n\n            var labelInstance = new Label(resolveLabelOptions(nodeEl, labels, sankeyBox.width()));\n            var labelVisual = labelInstance.exportVisual();\n            if (labelVisual) {\n                box.wrap(dataviz.rectToBox(labelVisual.rawBBox()));\n            }\n        });\n\n        var offsetX = sankeyBox.x1;\n        var offsetY = sankeyBox.y1;\n\n        var width = sankeyBox.width() + offsetX;\n        var height = sankeyBox.height() + offsetY;\n\n        width -= box.x2 > sankeyBox.width() ? box.x2 - sankeyBox.width() : 0;\n        height -= box.y2 > sankeyBox.height() ? box.y2 - sankeyBox.height() : 0;\n\n        offsetX += box.x1 < 0 ? -box.x1 : 0;\n        offsetY += box.y1 < 0 ? -box.y1 : 0;\n\n        if (autoLayout === false) {\n            return {\n                sankey: calculateSankey($.extend({}, calcOptions, {offsetX: offsetX, offsetY: offsetY, width: width, height: height, autoLayout: false})),\n                legendBox: legendBox,\n                titleBox: titleBox\n            };\n        }\n\n        if (this.resize && autoLayout && this.permutation) {\n            this.resize = false;\n            return {\n                sankey: calculateSankey($.extend({}, calcOptions, {offsetX: offsetX, offsetY: offsetY, width: width, height: height}, this.permutation)),\n                legendBox: legendBox,\n                titleBox: titleBox\n            };\n        }\n\n        var startColumn = 1;\n        var loops = 2;\n        var columnsLength = calculateSankey($.extend({}, calcOptions, {offsetX: offsetX, offsetY: offsetY, width: width, height: height, autoLayout: false})).columns.length;\n        var results = [];\n\n        var permutation = function (targetColumnIndex, reverse) {\n            var currPerm = calculateSankey($.extend({}, calcOptions, {offsetX: offsetX, offsetY: offsetY, width: width, height: height, loops: loops, targetColumnIndex: targetColumnIndex, reverse: reverse}));\n            var crosses = crossesValue(currPerm.links);\n            results.push({\n                crosses: crosses,\n                reverse: reverse,\n                targetColumnIndex: targetColumnIndex\n            });\n            return crosses === 0;\n        };\n\n        for (var index = startColumn; index <= columnsLength - 1; index++) {\n            if (permutation(index, false) || permutation(index, true)) {\n                break;\n            }\n        }\n\n        var minCrosses = Math.min.apply(null, results.map(function (r) { return r.crosses; }));\n        var bestResult = results.find(function (r) { return r.crosses === minCrosses; });\n        this.permutation = { targetColumnIndex: bestResult.targetColumnIndex, reverse: bestResult.reverse };\n        var result = calculateSankey($.extend({}, calcOptions, {offsetX: offsetX, offsetY: offsetY, width: width, height: height}, this.permutation));\n\n        return {\n            sankey: result,\n            legendBox: legendBox,\n            titleBox: titleBox\n        };\n    };\n\n    Sankey.prototype._render = function _render (options, context) {\n        var sankeyOptions = options || this.options;\n        var sankeyContext = context || this;\n\n        var data = sankeyOptions.data;\n        var labelOptions = sankeyOptions.labels;\n        var nodesOptions = sankeyOptions.nodes;\n        var linkOptions = sankeyOptions.links;\n        var nodeColors = sankeyOptions.nodeColors;\n        var title = sankeyOptions.title;\n        var legend = sankeyOptions.legend;\n        var ref = sankeyContext.size;\n        var width = ref.width;\n        var height = ref.height;\n\n        var calcOptions = $.extend({}, data, {width: width, height: height, nodesOptions: nodesOptions, title: title, legend: legend});\n        var ref$1 = this.calculateSankey(calcOptions, sankeyOptions);\n        var sankey = ref$1.sankey;\n        var titleBox = ref$1.titleBox;\n        var legendBox = ref$1.legendBox;\n        var nodes = sankey.nodes;\n        var links = sankey.links;\n\n        var visual = new drawing.Group({\n            clip: drawing.Path.fromRect(new geometry.Rect([0, 0], [width, height]))\n        });\n\n        if (titleBox) {\n            var titleElement = new Title$1($.extend({}, title, {drawingRect: titleBox}));\n            var titleVisual = titleElement.exportVisual();\n            visual.append(titleVisual);\n        }\n\n        if (sankey.circularLinks) {\n            return visual;\n        }\n\n        var visualNodes = new Map();\n        sankeyContext.nodesVisuals = visualNodes;\n\n        nodes.forEach(function (node, i) {\n            var nodeOps = resolveNodeOptions(node, nodesOptions, nodeColors, i);\n\n            var nodeInstance = new Node(nodeOps);\n            var nodeVisual = nodeInstance.exportVisual();\n            nodeVisual.links = [];\n            nodeVisual.type = NODE;\n\n            node.color = nodeOps.color;\n            node.opacity = nodeOps.opacity;\n\n            nodeVisual.dataItem = $.extend({}, data.nodes[i],\n                {color: nodeOps.color,\n                opacity: nodeOps.opacity,\n                sourceLinks: node.sourceLinks.map(function (link) { return ({ sourceId: link.sourceId, targetId: link.targetId, value: link.value }); }),\n                targetLinks: node.targetLinks.map(function (link) { return ({ sourceId: link.sourceId, targetId: link.targetId, value: link.value }); })});\n            visualNodes.set(node.id, nodeVisual);\n\n            visual.append(nodeVisual);\n        });\n\n        var sortedLinks = links.slice().sort(function (a, b) { return b.value - a.value; });\n\n        var linksVisuals = [];\n        sankeyContext.linksVisuals = linksVisuals;\n\n        sortedLinks.forEach(function (link) {\n            var source = link.source;\n            var target = link.target;\n            var sourceNode = visualNodes.get(source.id);\n            var targetNode = visualNodes.get(target.id);\n            var linkOps = resolveLinkOptions(link, linkOptions, sourceNode, targetNode);\n            var linkInstance = new Link(linkOps);\n            var linkVisual = linkInstance.exportVisual();\n\n            linkVisual.type = LINK;\n            linkVisual.dataItem = {\n                source: $.extend({}, sourceNode.dataItem),\n                target: $.extend({}, targetNode.dataItem),\n                value: link.value\n            };\n            linkVisual.linkOptions = linkOps;\n            linksVisuals.push(linkVisual);\n\n            sourceNode.links.push(linkVisual);\n            targetNode.links.push(linkVisual);\n\n            visual.append(linkVisual);\n        });\n\n        var diagramWidth = nodes.reduce(function (acc, node) { return Math.max(acc, node.x1); }, 0);\n        nodes.forEach(function (node) {\n            var textOps = resolveLabelOptions(node, labelOptions, diagramWidth);\n            var labelInstance = new Label(textOps);\n            var labelVisual = labelInstance.exportVisual();\n\n            if (labelVisual) {\n                visual.append(labelVisual);\n            }\n        });\n\n        if (legendBox) {\n            var legendElement = new Legend($.extend({}, legend, {drawingRect: legendBox, nodes: nodes}));\n            var legendVisual = legendElement.exportVisual();\n            visual.append(legendVisual);\n        }\n\n        return visual;\n    };\n\n    Sankey.prototype.exportVisual = function exportVisual (exportOptions) {\n        var options = (exportOptions && exportOptions.options) ?\n            deepExtend({}, this.options, exportOptions.options) : this.options;\n\n        var context = {\n            size: {\n                width: defined(exportOptions && exportOptions.width) ? exportOptions.width : this.size.width,\n                height: defined(exportOptions && exportOptions.height) ? exportOptions.height : this.size.height\n            }\n        };\n\n        return this._render(options, context);\n    };\n\n    Sankey.prototype._setOptions = function _setOptions (options) {\n        this.options = deepExtend({}, this.options, options);\n    };\n\n    return Sankey;\n}(dataviz.Observable));\n\nsetDefaultOptions(Sankey, {\n    title: {\n        position: constants.TOP, // 'top', 'bottom'\n    },\n    labels: {\n        visible: true,\n        margin: {\n            left: 8,\n            right: 8\n        },\n        padding: 0,\n        border: {\n            width: 0\n        },\n        paintOrder: 'stroke',\n        stroke: {\n            lineJoin: \"round\",\n            width: 1\n        },\n        align: constants.LEFT,\n        offset: { left: 0, top: 0 }\n    },\n    nodes: {\n        width: 24,\n        padding: 16,\n        opacity: 1,\n        align: 'stretch', // 'left', 'right', 'stretch'\n        offset: { left: 0, top: 0 }\n    },\n    links: {\n        colorType: 'static', // 'source', 'target', 'static'\n        opacity: 0.4,\n        highlight: {\n            opacity: 0.8,\n            inactiveOpacity: 0.2\n        }\n    },\n    tooltip: {\n        followPointer: false,\n        delay: 200\n    }\n});\n\nvar createSankeyData = function (data, dimensions, measure) {\n    var nodes = new Set();\n    var links = new Map();\n    var linksMap = new Map();\n\n    data.forEach(function (row) {\n        dimensions.forEach(function (dimension) {\n            nodes.add(dimension.value(row));\n        });\n\n        for (var i = 0; i < dimensions.length - 1; i++) {\n            var source = dimensions[i].value(row);\n            var target = dimensions[i + 1].value(row);\n            var key = source + \"_\" + target;\n            var value = measure.value(row);\n            var existingValue = links.get(key);\n\n            if (existingValue !== undefined) {\n                links.set(key, existingValue + value);\n            } else {\n                links.set(key, value);\n                linksMap.set(key, { source: source, target: target });\n            }\n        }\n    });\n\n    var nodesId = new Map();\n    var nodesArray = Array.from(nodes).map(function (node, index) {\n        nodesId.set(node, index);\n        return { id: index, label: { text: String(node) } };\n    });\n\n    var linksArray = Array.from(links).map(function (ref) {\n        var key = ref[0];\n        var value = ref[1];\n\n        var ref$1 = linksMap.get(key);\n        var source = ref$1.source;\n        var target = ref$1.target;\n        return {\n            sourceId: nodesId.get(source),\n            targetId: nodesId.get(target),\n            value: value\n        };\n    });\n\n    return { nodes: nodesArray, links: linksArray };\n};\n\nkendo.deepExtend(kendo.dataviz, {\n    Sankey: Sankey,\n    createSankeyData: createSankeyData\n});\n\n})(window.kendo.jQuery);\n\n(function($) {\n    var kendo = window.kendo;\n    var Widget = kendo.ui.Widget;\n\n    var encode = kendo.htmlEncode;\n    var styleAttr = '__style';\n    var tooltipContentWrapStyle = `${styleAttr}=\"display: flex; align-items: center;\"`;\n    var space = 3;\n    var TootipText = (text) => `<span ${styleAttr}=\"margin: 0 ${space}px\">${text}</span>`;\n    var Square = (color) => `<div ${styleAttr}=\"width: 15px; height: 15px; background-color: ${color}; display: inline-flex; margin-left: ${space}px\"></div>`;\n    var TooltipTemplates = {\n        node: function({ dataItem, value }) {\n            const { color, label } = dataItem;\n            return (\n                `<div ${tooltipContentWrapStyle}>\n                    ${Square(color)}\n                    ${TootipText(encode(label.text))}\n                    ${TootipText(value)}\n                </div>`\n            );\n        },\n        link: function({ dataItem, value }) {\n            const { source, target } = dataItem;\n            return (\n                `<div ${tooltipContentWrapStyle}>\n                    ${Square(source.color)}\n                    ${TootipText(encode(source.label.text))}\n                    ${TootipText(kendo.ui.icon({ icon: \"arrow-right\" }))}\n                    ${Square(target.color)}\n                    ${TootipText(encode(target.label.text))}\n                    ${TootipText(value)}\n                </div>`\n            );\n        }\n    };\n\n    var SankeyTooltip = Widget.extend({\n        init: function(element, options) {\n            this.options = options;\n\n            Widget.fn.init.call(this, element);\n\n            this.element.addClass('k-tooltip k-chart-tooltip k-chart-shared-tooltip')\n                .append('<div class=\"k-tooltip-content\"></div>');\n        },\n\n        size: function() {\n            return {\n                width: this.element.outerWidth(),\n                height: this.element.outerHeight()\n            };\n        },\n\n        setContent: function(content) {\n            this.element.find('.k-tooltip-content').html(content);\n            this.element.find(`[${styleAttr}]`).each((i, el) => {\n                el.getAttribute(styleAttr)\n                    .split(';')\n                    .filter(s => s !== '')\n                    .forEach(s => {\n                        const parts = s.split(':');\n                        el.style[parts[0].trim()] = parts[1].trim();\n                    });\n                el.removeAttribute(styleAttr);\n            });\n        },\n\n        setPosition: function(popupAlign, popupOffset, offsetOption) {\n            const size = this.size();\n            const offset = { ...popupOffset };\n\n            offset.left += (popupAlign.horizontal === 'left') ? offsetOption : (-1 * offsetOption);\n            if (popupAlign.horizontal === 'right') {\n                offset.left -= size.width;\n            }\n\n            if (popupAlign.vertical === 'bottom') {\n                offset.top -= size.height + offsetOption;\n            } else {\n                offset.top += offsetOption;\n            }\n\n            this.element.css(offset);\n        },\n\n        show: function() {\n            this.element.show();\n        },\n\n        hide: function() {\n            this.element.hide();\n        },\n\n        destroy: function() {\n            this.element.remove();\n        }\n    });\n\n    kendo.deepExtend(kendo.dataviz, {\n        SankeyTooltip: {\n            Tooltip: SankeyTooltip,\n            ContentTemplates: TooltipTemplates\n        }\n    });\n})(window.kendo.jQuery);\n\n(function($) {\n    var kendo = window.kendo;\n    var template = kendo.template;\n    var Widget = kendo.ui.Widget;\n    var dataviz = kendo.dataviz;\n    var defined = dataviz.defined;\n    var encode = kendo.htmlEncode;\n    var KendoSankey = dataviz.Sankey;\n    var NODE_CLICK = \"nodeClick\";\n    var LINK_CLICK = \"linkClick\";\n    var NODE_ENTER = \"nodeEnter\";\n    var NODE_LEAVE = \"nodeLeave\";\n    var LINK_ENTER = \"linkEnter\";\n    var LINK_LEAVE = \"linkLeave\";\n    var TOOLTIP_SHOW = \"tooltipShow\";\n    var TOOLTIP_HIDE = \"tooltipHide\";\n    var NODE = 'node';\n\n    const { Tooltip, ContentTemplates } = dataviz.SankeyTooltip;\n\n    var Sankey = Widget.extend({\n        init: function(element, userOptions) {\n            kendo.destroy(element);\n            $(element).empty();\n\n            this.options = kendo.deepExtend(this.options, userOptions);\n\n            Widget.fn.init.call(this, element);\n\n            this.wrapper = this.element;\n            this._initSankey();\n\n            this._attachEvents();\n\n            kendo.notify(this, dataviz.ui);\n\n            if (this._showWatermarkOverlay) {\n                this._showWatermarkOverlay(this.wrapper[0]);\n            }\n        },\n\n        setOptions: function(options) {\n            var currentOptions = this.options;\n\n            this.events.forEach(eventName => {\n                if (currentOptions[eventName]) {\n                    this.unbind(eventName, currentOptions[eventName]);\n                }\n            });\n\n            this._instance.setOptions(options);\n\n            this.bind(this.events, this._instance.options);\n        },\n\n        _initSankey: function() {\n            const themeOptions = this._getThemeOptions(this.options);\n            const { seriesColors: nodeColors, axisDefaults, seriesDefaults, legend, title } = themeOptions;\n            const { line: links, labels } = axisDefaults;\n            const strokeColor = seriesDefaults.labels.background;\n\n            this._createSankey(this.options, { nodeColors, links, labels: { ...labels, stroke: { color: strokeColor } }, legend, title });\n            this.options = this._instance.options;\n        },\n\n        _createSankey: function(options, themeOptions) {\n            this._instance = new KendoSankey(this.element[0], options, themeOptions);\n        },\n\n        _getThemeOptions: function(userOptions) {\n            var themeName = (userOptions || {}).theme;\n\n            if (themeName && dataviz.SASS_THEMES.indexOf(themeName.toLowerCase()) !== -1) {\n                return dataviz.autoTheme().chart;\n            }\n\n            if (defined(themeName)) {\n                var themes = dataviz.ui.themes || {};\n                var theme = themes[themeName] || themes[themeName.toLowerCase()] || {};\n                return theme.chart || {};\n            }\n        },\n\n        _attachEvents: function() {\n            this.events.forEach(eventName => {\n                this._instance.bind(eventName, event => {\n                    if (this._events[eventName]) {\n                        this._events[eventName].forEach(handler => handler.call(undefined, event));\n                    }\n                });\n            });\n\n            this._instance.bind(TOOLTIP_SHOW, this.tooltipShow.bind(this));\n            this._instance.bind(TOOLTIP_HIDE, this.tooltipHide.bind(this));\n        },\n\n        tooltipShow: function(e) {\n            if (!this._tooltip) {\n                const doc = this.element[0].ownerDocument;\n                this._tooltip = new Tooltip(doc.createElement('div'), {});\n                const { appendTo = doc.body } = this.options.tooltip;\n                this._tooltip.element.appendTo($(appendTo));\n            }\n\n            const { nodeTemplate, linkTemplate, offset } = this.options.tooltip;\n            const currentTemplate = template((e.targetType === NODE ? nodeTemplate : linkTemplate) || ContentTemplates[e.targetType]);\n            const value = encode(kendo.format(this.options.messages.tooltipUnits, defined(e.nodeValue) ? e.nodeValue : e.dataItem.value));\n\n            this._tooltip.setContent(currentTemplate({ dataItem: e.dataItem, value }));\n            this._tooltip.setPosition(e.tooltipData.popupAlign, e.tooltipData.popupOffset, offset);\n            this._tooltip.show();\n        },\n\n        tooltipHide: function() {\n            if (this._tooltip) {\n                this._tooltip.destroy();\n                this._tooltip = null;\n            }\n        },\n\n        exportVisual: function(exportOptions) {\n            return this._instance.exportVisual(exportOptions);\n        },\n\n        destroy: function() {\n            Widget.fn.destroy.call(this);\n            this.tooltipHide();\n            this._instance.destroy();\n            this._instance = null;\n        },\n\n        events: [\n            NODE_CLICK,\n            LINK_CLICK,\n            NODE_ENTER,\n            NODE_LEAVE,\n            LINK_ENTER,\n            LINK_LEAVE\n        ],\n        options: {\n            name: \"Sankey\",\n            theme: \"default\",\n            tooltip: {\n                offset: 12\n            },\n            messages: {\n                tooltipUnits: \"({0} Units)\"\n            }\n        }\n    });\n\n    dataviz.ExportMixin.extend(Sankey.fn);\n\n    if (kendo.PDFMixin) {\n        kendo.PDFMixin.extend(Sankey.fn);\n    }\n\n    dataviz.ui.plugin(Sankey);\n\n    kendo.deepExtend(dataviz, {\n        Sankey\n    });\n\n})(window.kendo.jQuery);\n\nlet __meta__ = {\n    id: \"dataviz.sankey\",\n    name: \"Sankey\",\n    category: \"dataviz\",\n    description: \"The Sankey widget uses modern browser technologies to render high-quality data visualizations in the browser.\",\n    depends: [ \"data\", \"userevents\", \"drawing\", \"dataviz.core\", \"dataviz.themes\" ],\n    features: [{\n        id: \"dataviz.sankey-pdf-export\",\n        name: \"PDF export\",\n        description: \"Export Sankey as PDF\",\n        depends: [ \"pdf\" ]\n    }]\n};\n\nvar kendo$1 = kendo;\n\nexport { kendo$1 as default };\n"]}